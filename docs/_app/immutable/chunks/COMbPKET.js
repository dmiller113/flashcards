import{p as d,x as _,B as h,y as v,c as l,l as p,h as u,j as m,an as b,m as g,b as k,a as y,ao as w,ap as x,aq as A,a1 as F,g as M}from"./7pJ4Fi5V.js";class B{anchor;#t=new Map;#s=new Map;#e=new Map;#a=!0;constructor(s,a=!0){this.anchor=s,this.#a=a}#r=()=>{var s=d;if(this.#t.has(s)){var a=this.#t.get(s),t=this.#s.get(a);if(t)_(t);else{var e=this.#e.get(a);e&&(this.#s.set(a,e.effect),this.#e.delete(a),e.fragment.lastChild.remove(),this.anchor.before(e.fragment),t=e.effect)}for(const[r,i]of this.#t){if(this.#t.delete(r),r===s)break;const n=this.#e.get(i);n&&(h(n.effect),this.#e.delete(i))}for(const[r,i]of this.#s){if(r===a)continue;const n=()=>{if(Array.from(this.#t.values()).includes(r)){var o=document.createDocumentFragment();b(i,o),o.append(l()),this.#e.set(r,{effect:i,fragment:o})}else h(i);this.#s.delete(r)};this.#a||!t?v(i,n,!1):n()}}};#i=s=>{this.#t.delete(s);const a=Array.from(this.#t.values());for(const[t,e]of this.#e)a.includes(t)||(h(e.effect),this.#e.delete(t))};ensure(s,a){var t=d,e=g();if(a&&!this.#s.has(s)&&!this.#e.has(s))if(e){var r=document.createDocumentFragment(),i=l();r.append(i),this.#e.set(s,{effect:p(()=>a(i)),fragment:r})}else this.#s.set(s,p(()=>a(this.anchor)));if(this.#t.set(t,s),e){for(const[n,c]of this.#s)n===s?t.skipped_effects.delete(c):t.skipped_effects.add(c);for(const[n,c]of this.#e)n===s?t.skipped_effects.delete(c.effect):t.skipped_effects.add(c.effect);t.oncommit(this.#r),t.ondiscard(this.#i)}else u&&(this.anchor=m),this.#r()}}function R(f,s,...a){var t=new B(f);k(()=>{const e=s()??null;t.ensure(e,e&&(r=>e(r,...a)))},F)}function T(f){return(s,...a)=>{var t=f(...a),e;if(u)e=m,y();else{var r=t.render().trim(),i=w(r);e=M(i),s.before(e)}const n=t.setup?.(e);x(e,e),typeof n=="function"&&A(n)}}export{B,T as c,R as s};
